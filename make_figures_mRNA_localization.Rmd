---
title: "Rate limiting steps of mRNA localization"
author: "Jonathan Harrison"
date: "22/09/2017"
output: html_document
fig_width: 6
fig_height: 4
---
```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=6, fig.height=4,
                      echo=FALSE, warning=FALSE, message=FALSE)
```
Outline of Figures:

Fig1: Drosophila egg chambers exhibit a characteristic network structure of connections between nurse cells A) Cartoon of tissue, B) Equivalent image of tissue, C) Diagram of connections between NCs via RCs.
![optional caption text](plots/schematic.png){ width=30% }
![optional caption text](data/Example4/20170714_oocyte_stg6_phalloidin-488_grk-546_Z_02.png){ width=30% }
![optional caption text](plots/NC_map.png){ width=30% }

Fig2: Behaviour of differential equation model. A) Dynamics in time shown for each cell, B) Model related to network structure of nurse cells.
```{r, Fig2, echo=FALSE,message=FALSE}
source('mrna_transport_sims_and_plot.R')
mrna_transport_sims_and_plot(identifier='v003',nSamples=15,nTest=5,th=c(10,25),sig=10^-9,phi=0.289,nu=0.95)
```

Fig3: Assembly of higher order complexes in oocyte A) Particles in different regions of the egg chamber, B) Distribution of intensities of particles in different regions.

```{r, Fig3, echo=FALSE,message=FALSE}
#setup
library(dplyr)
library(ggplot2)
v <- seq(from=2,to=6) #labelled data
regions <- c('background','nurse_cells','oocyte')
particles <- data.frame(Area=numeric(),Mean=numeric(),Min=numeric(),Max=numeric(),RawIntDen=numeric(),Region=factor(),Sample=factor())

#####################
#loop over each regions
for (r in seq_along(regions)){
  #get list of files for all examples, and extract results for a given region
  #returns a list of results for all examples for a given region
  temp <- list.files(path = paste('data/Example',v,'/',sep=''), pattern = "\\.xls$",full.names=TRUE) %>%
    grep(regions[r],. , value=TRUE) %>% 
    lapply(.,read.table)

  #take results for each example and add to data frame  
  for (j in seq_along(temp)){
    Region <- rep(regions[r],nrow(temp[[j]]))
    Sample <- rep(j,nrow(temp[[j]]))
    particles <- rbind(particles,cbind(cbind(temp[[j]],Region),Sample))  
  }
}
#########################
#process by subtracting background values and valculating ratio
processed <- particles %>% 
  group_by(Sample) %>% 
  mutate(MeanBgd = mean(RawIntDen[Region=='background']),BgdSubtract = RawIntDen-MeanBgd)

q <- processed %>%
  select(BgdSubtract,Region,Sample) %>%
  group_by(Region) %>%
  mutate(MeanByRegion = mean(BgdSubtract),StdByRegion = sd(BgdSubtract))
q <- q %>%
mutate(Ratio = MeanByRegion/median(q$MeanByRegion))
hh <- ggplot(q,aes(Region,BgdSubtract/MeanByRegion[Region=='nurse_cells'])) +
  geom_violin() + 
  geom_jitter() +
  theme_bw() +
  scale_x_discrete("Region", labels = c("background" = "BGD","oocyte" = "OO","nurse_cells" = "NC")) +
  ylab('Normalised intensity')
print(hh)
ggsave(paste('plots/processed_particle_data','.eps',sep=''),device=cairo_ps)
```


Fig4: Characterisation of the bias in directionality of transport through ring canals A) Schematic of transport between two compartments, B) Posterior pairs plot, C) Posterior predictive plot.
![optional caption text](plots/fig4_schematic.eps){ width=30% }
```{r, Fig4, echo=FALSE,message=FALSE}
source('run_model_comparison_stst.R')
run_model_comparison_stst(identifier='MCv057',use_real_data=TRUE,run_mcmc=FALSE,nSamples=15,nTest=5,parametersToPlot = c('nu','xi','phi'),verbose=FALSE,show_diagnostic_plots=TRUE)
```

Fig5: Results of inference for dynamic model A) Posterior pairs plot, B) Posterior predictive distribution, C) Sensitivity to a, b.
```{r, Fig5, echo=FALSE,message=FALSE}
source('mrna_transport_inference_input_B.R')
mrna_transport_inference_input_B(identifier='v057',use_real_data=TRUE,run_mcmc=FALSE,nSamples=15,nTest=5,parametersToPlot = c("a","b","phi","sigma"),verbose=FALSE,show_diagnostic_plots=TRUE)
source('sensitivity_and_analytics.R')
```

Fig6: Validation of testable prediction for over expression versus measured results.  
```{r, Fig6, echo=FALSE}
plot(cars)
```

FigS1: (Supplementary) Exponential growth model to establish timescales A) Schematic of time points used for each stage, B) Linear regression of log(A) against the time points for each stage.
```{r, FigS1, echo=FALSE}
source('extract_times_and_scaling.R')
extract_times_and_scaling(nSamples=15,nTest=5,optional_plot=TRUE)
```

FigS2: Convergence diagnostics for MCMC inference methods
```{r, FigS2, echo=FALSE}
![MCMC trace corresponding to Figure 4](plots/traceMCv057.eps){ width=30% }
![MCMC trace corresponding to Figure 5](plots/tracev057.eps){ width=30% }
```
