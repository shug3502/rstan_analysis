---
title: "RNA decay in model of RNA transport during oogenesis"
output: html_notebook
---


RNA can be regulated in different ways, including via transcription, export, transport and decay. RNA decay can be key to regulation under certain circumstances. In the context of *gurken* (*grk*) during oogenesis, it is not clear how the pattern of *grk* RNA localization is regulated between stages 6 and 7 when there is a change from posterior localization to dorsal anterior localization along with movement of the nucleus.
Within the context of our model of RNA transport in the *Drosophila* egg chamber, we are interested in whether RNA decay should be included within the model and whether the effects of this are important. Understanding the role of RNA decay in this system will help improve our understanding of the role of RNA decay in regulation of RNA localization.

We examine and compare two models for RNA transport in the *Drosophila* egg chamber. The first model neglects RNA decay.
\begin{equation} \label{model_1}
 \frac{\text{d} \mathbf{y}}{\text{d}t} = a \textbf{v} + b \mathbf{B} \textbf{y}, 
\end{equation}

The second model assumes RNA decay at rate $\gamma b$ in each cell of the egg chamber:
\begin{align} \label{model_2}
 \frac{\text{d} \mathbf{y}}{\text{d}t} &= a \textbf{v} + b \mathbf{B} \textbf{y} - \gamma b \textbf{y}, \\
 &= a \textbf{v} + b \mathbf{\tilde{B}} \textbf{y}, 
\end{align}
where $\mathbf{\tilde{B}} = \mathbf{B} - \gamma \mathbf{I}$.

Mathematically, these models behave quite differently. Consider both models in the long time limit. When the decay parameter $\gamma$ is 0, as in model 1, the matrix $\mathbf{B}$ is not full rank. Due to conservation of mass, it has a zero eigenvalue, giving it a null space of dimension 1. To find the long time behaviour, we must find the eigenvector corresponding to the zero eigenvalue. However, with decay also present in the model (with $\gamma > 0$), then at steady state, the decay balances the production and there will be a constant RNA level in each cell including the oocyte. In this case, the matrix $\mathbf{\tilde{B}}$ is full rank and does not have any zero eigenvalues. Mathematically, these are distinct behaviours, but computationally the models are less straightforward to distinguish since for certain values of parameters, such as $\gamma \ll 1$, growth at a slow linear rate in the nurse cells may appear similar to constant RNA levels.

We consider model comparison by fitting model 1 and model 2 at steady state and comparing via leave-one-out cross validation (Vehtari et al 2017).
The data used here are the normalised distributions of RNA across the cells in the egg chamber. Data from each egg chamber sampled is normalized here such that the number of particles in the oocyte is 1. As a result, we are unable to examine differences between the predicted linear growth and constant RNA levels in the long time limit predicted by each of the models.
```{r}
source('mrna_transport_inference_input_B.R')
mrna_transport_inference_input_B(identifier='v105',use_real_data=TRUE,run_mcmc=TRUE,nSamples=15,nTest=5,
                                      parametersToPlot = c("theta","phi","sigma"),verbose=TRUE,
                                      show_diagnostic_plots=FALSE)
```



```{r}
library(loo)
library(rstan)
options(mc.cores = 4)
source('run_model_comparison_stst_with_decay.R')
q1 <- run_model_comparison_stst_with_decay(identifier = 'MC_with_decay_v102', run_mcmc=FALSE,use_real_data=TRUE, 
                                           nSamples=20,nTest=0,verbose=FALSE,show_diagnostic_plots=FALSE,compare_via_loo=TRUE)
loo_1 <- q1[[3]]
#rerun inference without decay or simply load from previous save
source('run_model_comparison_stst.R')
q2 <- run_model_comparison_stst(identifier='MC_without_decay_v103',use_real_data=TRUE,run_mcmc=FALSE,
                                nSamples=20,nTest=0,parametersToPlot=c('nu','xi','phi'),
                                verbose=FALSE,show_diagnostic_plots=FALSE,compare_via_loo=TRUE)
loo_2 <- q2[[3]]
compare(loo_1,loo_2)

# waic1 <- waic(extract_log_lik(q1[[2]]))
# waic2 <- waic(extract_log_lik(q2[[2]]))
# compare(waic1, waic2)
```